<!DOCTYPE html>
<html lang="en" id="htmlRoot">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Teacher Shirley's ET Platform</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Exo+2:wght@300;400;500&family=Noto+Serif+TC:wght@400;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåô</text></svg>">
  
  <style id="themeStyles">
    :root {
      /* --- Light Mode (Morning Mist) --- */
      --bg-light: linear-gradient(135deg, #eef2f3 0%, #d9e2ec 100%);
      --text-light: #2c3e50;
      --accent-light: #3498db; 
      --card-bg-light: rgba(255, 255, 255, 0.85);
      --card-border-light: rgba(255, 255, 255, 0.6);
      --shadow-light: 0 8px 32px rgba(31, 38, 135, 0.1);

      /* --- Dark Mode (Midnight Galaxy) --- */
      --bg-dark: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
      --text-dark: #ecf0f1;
      --accent-dark: #f1c40f; 
      --card-bg-dark: rgba(16, 26, 46, 0.8);
      --card-border-dark: rgba(255, 255, 255, 0.1);
      --shadow-dark: 0 8px 32px rgba(0, 0, 0, 0.5);

      /* Default (Light) */
      --bg: var(--bg-light);
      --text: var(--text-light);
      --accent: var(--accent-light);
      --card-bg: var(--card-bg-light);
      --card-border: var(--card-border-light);
      --shadow: var(--shadow-light);
    }

    /* Dark Mode Override */
    .dark {
      --bg: var(--bg-dark);
      --text: var(--text-dark);
      --accent: var(--accent-dark);
      --card-bg: var(--card-bg-dark);
      --card-border: var(--card-border-dark);
      --shadow: var(--shadow-dark);
    }

    * { box-sizing: border-box; transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); }
    body {
      margin: 0; padding: 0;
      font-family: 'Exo 2', 'Noto Serif TC', sans-serif;
      background: var(--bg);
      background-attachment: fixed;
      color: var(--text);
      min-height: 100vh;
      display: flex; flex-direction: column;
      overflow-x: hidden;
    }

    /* --- Particle Canvas --- */
    #particle-canvas {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: -1; pointer-events: none;
    }

    /* --- Controls --- */
    .controls { position: absolute; top: 20px; right: 20px; display: flex; gap: 15px; z-index: 100; }
    .control-btn { 
      background: var(--card-bg); border: 1px solid var(--card-border); 
      color: var(--text); padding: 10px; border-radius: 50%; cursor: pointer; 
      backdrop-filter: blur(4px); box-shadow: var(--shadow);
    }
    .control-btn:hover { transform: scale(1.1) rotate(10deg); color: var(--accent); }

    /* --- Header --- */
    header { 
      text-align: center; padding: 6vh 20px 2vh; z-index: 10; 
      animation: fadeInDown 1.5s ease-out;
    }
    h1 { 
      font-family: 'Cinzel Decorative', cursive; 
      font-size: 3.5rem; margin: 0; 
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
      background: linear-gradient(to right, var(--text), var(--accent));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .subtitle { font-size: 1.1rem; letter-spacing: 2px; opacity: 0.8; margin-top: 10px; font-weight: 300; }

    /* --- Main Container --- */
    .container {
      flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
      padding: 20px; z-index: 10; width: 100%; max-width: 1200px; margin: 0 auto;
    }

    /* --- 1. Intro Overlay (Envelope) --- */
    #intro-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.4); backdrop-filter: blur(8px);
      z-index: 1000; display: flex; justify-content: center; align-items: center;
      transition: opacity 1s;
    }
    
    .envelope-wrapper {
      position: relative; width: 300px; height: 200px; cursor: pointer;
      perspective: 1000px; animation: float 6s ease-in-out infinite;
    }
    
    .envelope {
      width: 100%; height: 100%; background: #e6dac8; /* Beige */
      position: absolute; border-radius: 5px; box-shadow: 0 15px 35px rgba(0,0,0,0.3);
      display: flex; justify-content: center; align-items: flex-end; overflow: hidden;
    }
    
    .card-flap {
      position: absolute; top: 0; left: 0; width: 100%; height: 50%; background: #dcd0be;
      clip-path: polygon(0 0, 100% 0, 50% 100%); transform-origin: top; transition: transform 0.6s 0.2s; z-index: 5;
    }
    
    .card-pocket {
      position: absolute; bottom: 0; left: 0; width: 100%; height: 50%; background: #e6dac8;
      z-index: 4; clip-path: polygon(0 0, 50% 40%, 100% 0, 100% 100%, 0 100%);
    }

    .seal {
      position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%);
      width: 40px; height: 40px; background: #c0392b; border-radius: 50%; z-index: 6;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.2); display: flex; justify-content: center; align-items: center;
      color: gold; font-family: 'Cinzel Decorative'; font-weight: 700; font-size: 1.2rem;
    }

    .letter {
      position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px;
      background: #fff; padding: 20px; text-align: center;
      transition: transform 0.8s; transform: translateY(100px); opacity: 0; z-index: 2;
    }

    /* Open Animation */
    .envelope-wrapper.open .card-flap { transform: rotateX(180deg); }
    .envelope-wrapper.open .envelope { transform: scale(1.5); opacity: 0; transition: all 1s 0.5s; pointer-events: none; }
    
    /* --- Letter View (After Envelope) --- */
    #letter-view {
      display: none; width: 90%; max-width: 600px; background: var(--card-bg);
      padding: 40px; border-radius: 10px; border: 1px solid var(--card-border);
      box-shadow: var(--shadow); backdrop-filter: blur(10px);
      text-align: center; opacity: 0; transform: translateY(20px); transition: all 1s;
    }
    #letter-view.show { opacity: 1; transform: translateY(0); display: block; }
    
    .letter-p { 
      font-size: 1.2rem; line-height: 1.8; margin-bottom: 20px; 
      opacity: 0; transform: translateY(20px); transition: all 0.8s ease; 
    }
    .letter-p.visible { opacity: 1; transform: translateY(0); }

    .choice-buttons { 
      display: flex; justify-content: center; gap: 20px; margin-top: 30px; 
      opacity: 0; transition: opacity 1s; 
    }
    .choice-buttons.visible { opacity: 1; }

    .btn {
      padding: 12px 30px; border: none; border-radius: 50px; cursor: pointer;
      font-size: 1rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;
      transition: all 0.3s;
    }
    .btn-primary { background: var(--accent); color: #fff; box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3); }
    .btn-secondary { background: transparent; border: 2px solid var(--text); color: var(--text); }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }

    /* --- Auth Form --- */
    #auth-form-container { display: none; margin-top: 20px; animation: fadeIn 0.5s; }
    .auth-input { width: 100%; padding: 10px; margin: 5px 0; border-radius: 5px; border: 1px solid var(--card-border); background: rgba(255,255,255,0.5); }

    /* --- 2. Visitor View --- */
    #visitor-view { display: none; width: 100%; max-width: 800px; text-align: center; }
    #visitor-view.active { display: block; animation: fadeIn 1s; }
    
    /* --- 3. Universe View (Main Dashboard) --- */
    #universe-view { display: none; width: 100%; max-width: 1200px; }
    #universe-view.active { display: block; animation: fadeIn 1s; }

    .dashboard-grid { 
      display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; 
      margin-top: 30px; 
    }
    .card {
      background: var(--card-bg); border: 1px solid var(--card-border);
      border-radius: 15px; padding: 25px; backdrop-filter: blur(5px);
      box-shadow: var(--shadow); position: relative; overflow: hidden;
      transition: transform 0.3s;
    }
    .card:hover { transform: translateY(-5px); }
    .card-title { font-family: 'Playfair Display', serif; font-size: 1.5rem; margin-bottom: 15px; color: var(--accent); }
    
    /* Planet (Check-in) */
    .planet-container { height: 150px; display: flex; justify-content: center; align-items: center; }
    .planet {
      width: 100px; height: 100px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #4facfe, #00f2fe);
      box-shadow: 0 0 30px #4facfe, inset -10px -10px 20px rgba(0,0,0,0.2);
      position: relative; transition: all 0.5s; cursor: pointer;
    }
    .planet:hover { transform: scale(1.1) rotate(20deg); box-shadow: 0 0 50px #00f2fe; }
    
    /* Word of the Day */
    .word-en { font-size: 2.5rem; font-weight: 700; margin-bottom: 5px; color: var(--text); }
    .word-part { font-style: italic; opacity: 0.7; font-size: 0.9rem; margin-bottom: 15px; }
    .word-zh { font-size: 1.2rem; color: var(--accent); }

    /* History & Calendar */
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; font-size: 0.8rem; margin-top: 10px; }
    
    /* Solar System Nav */
    .solar-system { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; flex-wrap: wrap; }
    .nav-planet { width: 40px; height: 40px; border-radius: 50%; background: #ccc; cursor: pointer; transition: transform 0.3s; position: relative; }
    .nav-planet:hover { transform: scale(1.2); }
    .nav-tooltip { position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); font-size: 0.7rem; opacity: 0; transition: opacity 0.3s; white-space: nowrap; pointer-events: none; }
    .nav-planet:hover .nav-tooltip { opacity: 1; }

    /* Print Styles */
    @media print {
      body * { visibility: hidden; }
      #print-area, #print-area * { visibility: visible; }
      #print-area { position: absolute; left: 0; top: 0; width: 100%; color: black; background: white; padding: 20px; }
      table { width: 100%; border-collapse: collapse; }
      th, td { border: 1px solid black; padding: 10px; text-align: left; }
    }
    .print-only { display: none; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

    /* Member Terminal (Overlay) */
    #member-terminal {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); z-index: 2000;
        display: none; justify-content: center; align-items: center;
        color: #0f0; font-family: 'Courier New', monospace;
    }
    #member-terminal.show { display: flex; }
    .terminal-window { width: 80%; max-width: 600px; height: 400px; border: 2px solid #0f0; padding: 20px; background: black; overflow-y: auto; }

    /* Logout Btn */
    #logoutBtn { display: none; margin-left: auto; }
  </style>
</head>
<body>

  <audio id="themeSong" loop>
    <source src="https://assets.mixkit.co/music/preview/mixkit-stars-in-space-854.mp3" type="audio/mpeg">
  </audio>
  <audio id="windchime">
      <source src="https://assets.mixkit.co/sfx/preview/mixkit-magic-wind-chime-alerts-2578.mp3" type="audio/mpeg">
  </audio>

  <canvas id="particle-canvas"></canvas>

  <div class="controls">
    <button class="control-btn" id="themeToggle" title="Toggle Theme">üåì</button>
    <button class="control-btn" id="musicToggle" title="Toggle Music">üéµ</button>
    <button class="control-btn" id="logoutBtn" title="Logout">üö™</button>
  </div>

  <header>
    <h1>Teacher Shirley's Platform</h1>
    <div class="subtitle">English Teaching & Learning Space</div>
  </header>

  <div class="container">
      
      <div id="intro-overlay">
          <div class="envelope-wrapper" onclick="openLetter()">
              <div class="envelope">
                  <div class="card-flap"></div>
                  <div class="card-pocket"></div>
                  <div class="seal">S</div>
              </div>
          </div>
          
          <div id="letter-view">
              <h2 style="font-family:'Cinzel Decorative'; margin-bottom:20px; color:var(--accent);">Welcome, Traveler</h2>
              <p class="letter-p">Welcome to my digital space. Here, we explore the universe of English together.</p>
              <p class="letter-p">Are you a curious Visitor just passing by, or a Student ready to continue your journey?</p>
              
              <div class="choice-buttons" id="choice-buttons">
                  <button class="btn btn-secondary" onclick="enterVisitorMode()">üëÄ Just Visiting</button>
                  <button class="btn btn-primary" onclick="showAuthForm()">üöÄ Log In</button>
              </div>

              <div id="auth-form-container">
                  <button class="btn btn-primary" id="google-login-btn" style="width:100%; margin-bottom:10px;">Login with Google</button>
                  <div style="margin:10px 0; font-size:0.8rem; opacity:0.7;">OR</div>
                  <input type="email" id="email-input" class="auth-input" placeholder="Email">
                  <input type="password" id="pass-input" class="auth-input" placeholder="Password">
                  <button class="btn btn-secondary" id="email-login-btn" style="width:100%; margin-top:10px;">Login / Sign Up</button>
                  <div style="margin-top:10px; cursor:pointer; font-size:0.8rem; text-decoration:underline;" onclick="hideAuthForm()">Back</div>
              </div>
          </div>
      </div>

      <div id="visitor-view">
          <h2>Visitor Access</h2>
          <p>Feel free to explore the public resources.</p>
          
          <div class="dashboard-grid">
              <div class="card word-card">
                  <div class="card-title">Word of the Day</div>
                  <div class="word-en" id="wotd-word">Loading...</div>
                  <div class="word-part"><span id="wotd-pos"></span> <span id="wotd-ipa"></span></div>
                  <div class="word-zh" id="wotd-meaning">...</div>
                  <div style="margin-top:15px; font-size:0.9rem; font-style:italic;" id="wotd-sentence-e"></div>
                  <div style="margin-top:5px; font-size:0.9rem; color:var(--accent);" id="wotd-sentence-c"></div>
                  <div style="margin-top:10px; font-size:0.7rem; opacity:0.5;" id="word-date"></div>
              </div>

              <div class="card">
                  <span style="font-size:0.7rem; text-transform:uppercase; color:var(--text-light); letter-spacing:1px;">Daily Quote</span>
                  <div style="font-family:'Playfair Display'; font-size:1.3rem; margin:15px 0; line-height:1.4;" id="qotd-text"></div>
                  <div style="font-size:0.95rem; color:var(--text-light);" id="qotd-trans"></div>
                  <div style="text-align:right; font-weight:bold; color:var(--accent); margin-top:10px;" id="qotd-author"></div>
              </div>
          </div>
          
          <div style="margin-top:50px;">
              <button class="btn btn-primary" onclick="location.reload()">Back to Entrance</button>
          </div>
      </div>

      <div id="universe-view">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
              <h2 id="greeting-name">Welcome to Moon Base</h2>
              <button class="btn btn-secondary" style="font-size:0.8rem; padding:5px 15px;" onclick="printRecords()">üñ®Ô∏è Print Report</button>
          </div>

          <div class="solar-system">
              <div class="nav-planet" style="background:#f1c40f;" onclick="visitPlanet('Sun', '#')"><div class="nav-tooltip">Sun (Home)</div></div>
              <div class="nav-planet" style="background:#bdc3c7;" onclick="visitPlanet('Mercury', 'https://www.youtube.com/')"><div class="nav-tooltip">Mercury (YouTube)</div></div>
              <div class="nav-planet" style="background:#e67e22;" onclick="visitPlanet('Venus', 'https://tw.dictionary.search.yahoo.com/')"><div class="nav-tooltip">Venus (Dictionary)</div></div>
              <div class="nav-planet" style="background:#3498db; border:2px solid white;" onclick="visitPlanet('Earth', '#')"><div class="nav-tooltip">Earth (Files)</div></div>
              <div class="nav-planet" style="background:#e74c3c;" onclick="visitPlanet('Mars', 'https://chatgpt.com/')"><div class="nav-tooltip">Mars (AI Chat)</div></div>
          </div>

          <div class="dashboard-grid">
              <div class="card">
                  <div class="card-title">Daily Check-in</div>
                  <div class="planet-container">
                      <div class="planet" onclick="handleCheckIn()"></div>
                  </div>
                  <div style="text-align:center; margin-top:15px;">
                      <button class="btn btn-primary" id="checkin-btn" onclick="handleCheckIn()">Check In</button>
                  </div>
                  <div style="display:flex; justify-content:space-around; margin-top:15px; font-size:0.9rem;">
                      <div>Streak: <span id="streak-days" style="font-weight:bold; color:var(--accent);">0</span></div>
                      <div>Total: <span id="total-days" style="font-weight:bold;">0</span></div>
                  </div>
                  <div id="calendar-grid" class="calendar-grid"></div>
              </div>

              <div class="card word-card">
                  <div class="card-title">My Learning</div>
                  <p>Review today's content in Visitor Mode for details.</p>
                  <button class="btn btn-secondary" onclick="enterVisitorMode()">Go to Visitor Mode</button>
              </div>
          </div>
      </div>

  </div>

  <div id="print-area" class="print-only">
      <div class="print-header" style="text-align:center; border-bottom:2px solid black; margin-bottom:20px; padding-bottom:10px;">
          <h1>My Learning Journey</h1>
          <p>Student: <span id="print-name"></span> | Date: <span id="print-date"></span></p>
      </div>
      <table id="print-table"><thead><tr><th>Date</th><th>Word / Topic</th><th>Activity Details</th></tr></thead><tbody id="print-body"></tbody></table>
  </div>

  <footer class="page-footer" style="margin-top:3rem; padding:2rem; text-align:center; font-size:0.8rem; color:var(--text-light); opacity:0.6;">
    <div>¬©Ô∏è Teacher Shirley‚Äòs ET Platform 2025</div>
    <span id="busuanzi_container_site_pv">Total Visits: <span id="busuanzi_value_site_pv"></span></span>
  </footer>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  <script type="module" src="/main.js"></script>
</body>
</html>
